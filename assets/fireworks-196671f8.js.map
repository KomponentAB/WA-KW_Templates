{"version":3,"file":"fireworks-196671f8.js","sources":["../../src/models/footstep.model.ts","../../src/config/footstep.config.ts","../../src/footstep.ts","../../src/config/fireworks.config.ts","../../src/fireworks.ts"],"sourcesContent":["export enum MaterialType {\n  wood = \"wood\",\n  forest = \"forest\",\n  snow = \"snow\",\n  marble = \"marble\",\n  stone = \"stone\",\n  mud = \"mud\",\n  path = \"path\",\n  water = \"water\",\n  sand = \"sand\",\n  ice = \"ice\"\n}\n\nexport interface SoundArea {\n  name: string;\n  y: number;\n  x: number;\n  width?: number;\n  height?: number;\n  material?: MaterialType;\n}\n","import { SoundConfig } from \"@workadventure/iframe-api-typings/play/src/front/Api/Iframe/Sound/Sound\";\nimport { MaterialType } from \"../models/footstep.model\";\n\nexport const soundFiles: Record<MaterialType, string[]> = {\n  [MaterialType.wood]: [\n    \"wood_01_a.wav\",\n    \"wood_01_b.wav\",\n    \"wood_01_c.wav\",\n    \"wood_01_d.wav\",\n  ],\n  [MaterialType.forest]: [\n    \"forest_01_a.wav\",\n    \"forest_01_b.wav\",\n    \"forest_01_c.wav\",\n    \"forest_01_d.wav\",\n    \"forest_01_e.wav\",\n  ],\n  [MaterialType.snow]: [\n    \"snow_01_a.wav\",\n    \"snow_01_b.wav\",\n    \"snow_01_c.wav\",\n    \"snow_01_d.wav\",\n  ],\n  [MaterialType.marble]: [\n    \"marble_01_a.wav\",\n    \"marble_01_b.wav\",\n    \"marble_01_c.wav\",\n    \"marble_01_d.wav\",\n  ],\n  [MaterialType.mud]: [\n    \"mud_01_a.wav\",\n    \"mud_01_b.wav\",\n    \"mud_01_c.wav\",\n    \"mud_01_d.wav\",\n  ],\n  [MaterialType.path]: [\n    \"path_01_a.wav\",\n    \"path_01_b.wav\",\n    \"path_01_c.wav\",\n    \"path_01_d.wav\",\n    \"path_01_e.wav\",\n  ],\n  [MaterialType.stone]: [\n    \"stone_01_a.wav\",\n    \"stone_01_b.wav\",\n    \"stone_01_c.wav\",\n    \"stone_01_d.wav\",\n    \"stone_01_e.wav\",\n  ],\n  [MaterialType.water]: [\n    \"water_01_a.wav\",\n    \"water_01_b.wav\",\n    //\"water_01_c.wav\" (Doesnt sound good)\n  ],\n  [MaterialType.sand]: [\n    \"sand_01_a.wav\",\n    \"sand_01_b.wav\",\n    \"sand_01_c.wav\",\n    //\"water_01_c.wav\" (Doesnt sound good)\n  ],\n  [MaterialType.ice]: [\n    \"ice_01.wav\",\n    \"ice_02.wav\",\n    \"ice_03.wav\",\n    \"ice_04.wav\",\n  ],\n\n\n};\n///some sounds are missing, but you can add them here\nexport const audioConfig: SoundConfig = {\n  volume: 0.05,\n  loop: false,\n  rate: 1.5,\n  detune: 1,\n  delay: 0,\n  seek: 0,\n  mute: false,\n};\n","import { Sound } from \"@workadventure/iframe-api-typings\";\nimport { getLayersMap } from \"@workadventure/scripting-api-extra/dist\";\nimport { audioConfig, soundFiles } from \"./config/footstep.config\";\nimport { MaterialType, SoundArea } from \"./models/footstep.model\";\n\nlet mySound: Sound;\nlet stepSoundAreas: any[] = [];\n\nfunction playRandomSound(material: MaterialType) {\n  if (!soundFiles[material]) return;\n\n  const randomIndex = Math.floor(Math.random() * soundFiles[material].length);\n  mySound = WA.sound.loadSound(\n    `${import.meta.env.BASE_URL}/sounds/${soundFiles[material][randomIndex]}`\n  );\n  mySound.play(audioConfig);\n}\n\nasync function getStepSoundAreas(): Promise<SoundArea[]> {\n  try {\n    const layers = await getLayersMap();\n    const areas = [];\n\n    for (const layer of layers.values()) {\n      if (layer.type === \"objectgroup\") {\n        for (const object of layer.objects) {\n          if (!object.properties) continue;\n          if (\n            object.properties.some(\n              (prop) => prop.name === \"stepSound\" && prop.value === true\n            )\n          ) {\n            const material = object.properties.find(\n              (prop) => prop.name === \"material\"\n            )?.value as MaterialType;\n\n            if (soundFiles[material]) {\n              areas.push({\n                name: object.name,\n                x: object.x,\n                y: object.y,\n                width: object.width,\n                height: object.height,\n                material: material,\n              });\n            }\n          }\n        }\n      }\n    }\n    console.log(\"Found step sound areas:\", areas);\n    return areas;\n  } catch (error) {\n    console.error(\"Error while getting step sound areas:\", error);\n    return [];\n  }\n}\n\nfunction isInsideArea(\n  playerPosition: { x: number; y: number },\n  area: {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n  }\n) {\n  return (\n    playerPosition.x >= area.x &&\n    playerPosition.x <= area.x + area.width &&\n    playerPosition.y >= area.y &&\n    playerPosition.y <= area.y + area.height\n  );\n}\n\nasync function checkPlayerMaterial(playerPosition: { x: number; y: number }) {\n  try {\n    for (const area of stepSoundAreas) {\n      if (isInsideArea(playerPosition, area)) {\n        return area.material;\n      }\n    }\n    return null;\n  } catch (error) {\n    console.error(\"Error while checking player material:\", error);\n    return null;\n  }\n}\n\nWA.onInit().then(async () => {\n  stepSoundAreas = await getStepSoundAreas();\n});\n\nexport { checkPlayerMaterial, mySound, playRandomSound };\n","export const FIREWORKS_CONFIG = {\n  animationLayer: \"anim\",\n  fireworkDuration: 1000 * 1.4, //1.4 seconds\n};\n\nexport enum FireworkColors {\n  RED = \"red\",\n  PINK = \"pink\",\n  GREEN = \"green\",\n  YELLOW = \"yellow\",\n  PURPLE = \"purple\",\n  BLUE = \"blue\",\n}\n","import { TileDescriptor } from \"@workadventure/iframe-api-typings\";\nimport { SoundConfig } from \"@workadventure/iframe-api-typings/play/src/front/Api/Iframe/Sound/Sound\";\nimport { FireworkColors, FIREWORKS_CONFIG } from \"./config/fireworks.config\";\n\nexport function setupFireworks(): void {\n  setupFireworksButton();\n  setupFireworksListener();\n  console.log(\"ðŸŽ† Fireworks initialized successfully\");\n}\n\nexport function setupFireworksButton(): void {\n  const button = \"firework-btn\";\n\n  WA.ui.actionBar.addButton({\n    id: button,\n    label: \"Fireworks! ðŸŽ†\",\n    //  type: \"button\",\n    callback: () => {\n      WA.ui.actionBar.removeButton(button); //remove button temporarily\n      triggerFirework()\n        .then((firework: FireworkConfig) => {\n          WA.event.broadcast(\"firework\", {\n            playerId: WA.player.id,\n            x: firework.x,\n            y: firework.y,\n            color: firework.color,\n          });\n        })\n        .finally(() => setupFireworksButton()); //restore button after fireworks promise\n    },\n  });\n}\n\ninterface FireworkConfig {\n  color: FireworkColors;\n  x: number;\n  y: number;\n}\n\nexport async function triggerFirework(\n  config?: FireworkConfig,\n): Promise<FireworkConfig> {\n  const tileConfig = config || (await generateFireworkConfig());\n  const tiles = await generateFireworkTiles(tileConfig);\n\n  WA.room.setTiles(tiles);\n\n  playSound(`./sounds/firework_single.mp3`);\n\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      try {\n        WA.room.setTiles([...tiles.map((x) => ({ ...x, tile: null }))]);\n        resolve(tileConfig);\n      } catch (e) {\n        console.error(\"Failed to trigger firework\", e);\n        reject(e);\n      }\n    }, FIREWORKS_CONFIG.fireworkDuration); // Remove tiles after FireworkDuration (1400ms)\n  });\n\n  function playSound(path: string) {\n    const newSound = WA.sound.loadSound(path);\n    const positive = Math.random() >= 0.5;\n    const detune = Math.round(Math.random() * 850);\n    const config: SoundConfig = {\n      loop: false,\n      detune: positive ? detune : -detune,\n    };\n    newSound.play(config);\n  }\n\n  async function generateFireworkConfig(): Promise<FireworkConfig> {\n    const { x, y } = await WA.player.getPosition();\n    return { x, y, color: getRandomFireworkColor() };\n  }\n\n  function getRandomFireworkColor() {\n    const colors = Object.values(FireworkColors);\n    return colors[Math.floor(Math.random() * colors.length)];\n  }\n\n  async function generateFireworkTiles(\n    config: FireworkConfig,\n  ): Promise<TileDescriptor[]> {\n    const tileConfig: TileDescriptor = {\n      x: Math.floor(config.x / 32),\n      y: Math.floor(config.y / 32),\n      layer: FIREWORKS_CONFIG.animationLayer,\n      tile: null, // Placeholder, will be set per tile\n    };\n\n    const tiles = new Array(9).fill(null).map((_, index) => {\n      const dx = (index % 3) - 1; // -1, 0, 1 for column offset\n      const dy = Math.floor(index / 3) - 1; // -1, 0, 1 for row offset\n      return {\n        ...tileConfig,\n        x: tileConfig.x + dx,\n        y: tileConfig.y + dy,\n        tile: `${config.color}_${index + 1}`,\n      };\n    });\n\n    return tiles;\n  }\n}\n\nfunction setupFireworksListener() {\n  WA.event.on(\"firework\").subscribe((value) => {\n    const { playerId, x, y, color } = value.data as {\n      playerId: string;\n    } & FireworkConfig;\n    if (playerId !== WA.player.id) {\n      triggerFirework({ x, y, color });\n    }\n  });\n}\n"],"names":["MaterialType","soundFiles","audioConfig","mySound","stepSoundAreas","playRandomSound","material","randomIndex","getStepSoundAreas","layers","getLayersMap","areas","layer","object","prop","_a","error","isInsideArea","playerPosition","area","checkPlayerMaterial","FIREWORKS_CONFIG","FireworkColors","setupFireworks","setupFireworksButton","setupFireworksListener","button","triggerFirework","firework","config","tileConfig","generateFireworkConfig","tiles","generateFireworkTiles","playSound","resolve","reject","x","e","path","newSound","positive","detune","y","getRandomFireworkColor","colors","_","index","dx","dy","value","playerId","color"],"mappings":"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"}