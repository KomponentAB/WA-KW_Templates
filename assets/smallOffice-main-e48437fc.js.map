{"version":3,"file":"smallOffice-main-e48437fc.js","sources":["../../src/models/footstep.model.ts","../../src/config/footstep.config.ts","../../src/footstep.ts","../../src/smallOffice-main.ts"],"sourcesContent":["export enum MaterialType {\n  wood = \"wood\",\n  forest = \"forest\",\n  snow = \"snow\",\n  marble = \"marble\",\n  stone = \"stone\",\n  mud = \"mud\",\n  path = \"path\",\n  water = \"water\",\n  sand = \"sand\"\n}\n\nexport interface SoundArea {\n  name: string;\n  y: number;\n  x: number;\n  width?: number;\n  height?: number;\n  material?: MaterialType;\n}\n","import { SoundConfig } from \"@workadventure/iframe-api-typings/play/src/front/Api/Iframe/Sound/Sound\";\nimport { MaterialType } from \"../models/footstep.model\";\n\nexport const soundFiles: Record<MaterialType, string[]> = {\n  [MaterialType.wood]: [\n    \"/sounds/wood_01_a.wav\",\n    \"/sounds/wood_01_b.wav\",\n    \"/sounds/wood_01_c.wav\",\n    \"/sounds/wood_01_d.wav\"\n  ],\n  [MaterialType.forest]: [\n    \"/sounds/forest_01_a.wav\",\n    \"/sounds/forest_01_b.wav\",\n    \"/sounds/forest_01_c.wav\",\n    \"/sounds/forest_01_d.wav\",\n    \"/sounds/forest_01_e.wav\"\n  ],\n  [MaterialType.snow]: [\n    \"/sounds/snow_01_a.wav\",\n    \"/sounds/snow_01_b.wav\",\n    \"/sounds/snow_01_c.wav\",\n    \"/sounds/snow_01_d.wav\"\n  ],\n  [MaterialType.marble]: [\n    \"/sounds/marble_01_a.wav\",\n    \"/sounds/marble_01_b.wav\",\n    \"/sounds/marble_01_c.wav\",\n    \"/sounds/marble_01_d.wav\"\n  ],\n  [MaterialType.mud]: [\n    \"/sounds/mud_01_a.wav\",\n    \"/sounds/mud_01_b.wav\",\n    \"/sounds/mud_01_c.wav\",\n    \"/sounds/mud_01_d.wav\"\n  ],\n  [MaterialType.path]: [\n    \"/sounds/path_01_a.wav\",\n    \"/sounds/path_01_b.wav\",\n    \"/sounds/path_01_c.wav\",\n    \"/sounds/path_01_d.wav\",\n    \"/sounds/path_01_e.wav\"\n  ],\n  [MaterialType.stone]: [\n    \"/sounds/stone_01_a.wav\",\n    \"/sounds/stone_01_b.wav\",\n    \"/sounds/stone_01_c.wav\",\n    \"/sounds/stone_01_d.wav\",\n    \"/sounds/stone_01_e.wav\"\n  ],\n  [MaterialType.water]: [\n    \"/sounds/water_01_a.wav\",\n    \"/sounds/water_01_b.wav\",\n    //\"/sounds/water_01_c.wav\" (Doesnt sound good)\n  ],\n  [MaterialType.sand]: [\n    \"/sounds/sand_01_a.wav\",\n    \"/sounds/sand_01_b.wav\",\n    \"/sounds/sand_01_c.wav\"\n    //\"/sounds/water_01_c.wav\" (Doesnt sound good)\n  ],\n};\n\nexport const audioConfig: SoundConfig = {\n  volume: 0.15,\n  loop: false,\n  rate: 1.5,\n  detune: 1,\n  delay: 0,\n  seek: 0,\n  mute: false,\n};\n","import { Sound } from \"@workadventure/iframe-api-typings\";\nimport { getLayersMap } from \"@workadventure/scripting-api-extra/dist\";\nimport { audioConfig, soundFiles } from \"./config/footstep.config\";\nimport { MaterialType, SoundArea } from \"./models/footstep.model\";\n\nlet mySound: Sound;\nlet stepSoundAreas: any[] = [];\n\nfunction playRandomSound(material: MaterialType) {\n  if (!soundFiles[material]) return;\n\n  const randomIndex = Math.floor(Math.random() * soundFiles[material].length);\n  mySound = WA.sound.loadSound(\n    `${import.meta.env.BASE_URL}${soundFiles[material][randomIndex]}`\n  );\n  mySound.play(audioConfig);\n}\n\nasync function getStepSoundAreas(): Promise<SoundArea[]> {\n  try {\n    const layers = await getLayersMap();\n    const areas = [];\n\n    for (const layer of layers.values()) {\n      if (layer.type === \"objectgroup\") {\n        for (const object of layer.objects) {\n          if (!object.properties) continue;\n          if (\n            object.properties.some(\n              (prop) => prop.name === \"stepSound\" && prop.value === true\n            )\n          ) {\n            const material = object.properties.find(\n              (prop) => prop.name === \"material\"\n            )?.value as MaterialType;\n\n            if (soundFiles[material]) {\n              areas.push({\n                name: object.name,\n                x: object.x,\n                y: object.y,\n                width: object.width,\n                height: object.height,\n                material: material,\n              });\n            }\n          }\n        }\n      }\n    }\n    console.log(\"Found step sound areas:\", areas);\n    return areas;\n  } catch (error) {\n    console.error(\"Error while getting step sound areas:\", error);\n    return [];\n  }\n}\n\nfunction isInsideArea(\n  playerPosition: { x: number; y: number },\n  area: {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n  }\n) {\n  return (\n    playerPosition.x >= area.x &&\n    playerPosition.x <= area.x + area.width &&\n    playerPosition.y >= area.y &&\n    playerPosition.y <= area.y + area.height\n  );\n}\n\nasync function checkPlayerMaterial(playerPosition: { x: number; y: number }) {\n  try {\n    for (const area of stepSoundAreas) {\n      if (isInsideArea(playerPosition, area)) {\n        return area.material;\n      }\n    }\n    return null;\n  } catch (error) {\n    console.error(\"Error while checking player material:\", error);\n    return null;\n  }\n}\n\nWA.onInit().then(async () => {\n  stepSoundAreas = await getStepSoundAreas();\n});\n\nexport { checkPlayerMaterial, mySound, playRandomSound };\n","/// <reference types=\"@workadventure/iframe-api-typings\" />\n/// <reference types=\"vite/client\" />\n\nimport { bootstrapExtra } from \"@workadventure/scripting-api-extra\";\nimport { checkPlayerMaterial, mySound, playRandomSound } from \"./footstep\";\n\nconsole.log('Script started successfully');\n\nlet currentPopup: any = undefined;\n\n// Waiting for the API to be ready\nWA.onInit().then(() => {\n    console.log('Scripting API ready');\n    console.log('Player tags: ',WA.player.tags)\n\n    WA.room.area.onEnter('clock').subscribe(() => {\n        const today = new Date();\n        const time = today.getHours() + \":\" + today.getMinutes();\n        currentPopup = WA.ui.openPopup(\"clockPopup\", \"It's \" + time, []);\n    })\n\n    WA.room.area.onLeave('clock').subscribe(closePopup)\n\n    // The line below bootstraps the Scripting API Extra library that adds a number of advanced properties/features to WorkAdventure\n    bootstrapExtra().then(() => {\n        console.log('Scripting API Extra ready');\n    }).catch(e => console.error(e));\n\n}).catch(e => console.error(e));\n\nfunction closePopup(){\n    if (currentPopup !== undefined) {\n        currentPopup.close();\n        currentPopup = undefined;\n    }\n}\n\n// Get an existing website object where 'my_website' is the name of the object (on any layer object of the map)\nasync function updateTitle() {\n    var text: string = WA.state.textVariable as string;\n    console.log('Text is configured as ' + text);\n    var color: string = WA.state.colorVariable as string;\n    console.log('Color is configured as ' + color);\n    var newTitle = `https://iw6tkif7th7yp5ax2ufzkl3kce0bcuys.lambda-url.us-east-1.on.aws/?text=${encodeURIComponent(text)}&imageType=caption&width=88&height=24&color=${encodeURIComponent(color)}`;\n    console.log('New img-url of title is ' + newTitle);\n    const website = await WA.room.website.get(\"titleScreen\");\n    website.url = newTitle;\n    website.visible = true;\n    console.log(`Title has been changed to ${website.url}`);\n};\nWA.onInit().then(() => { updateTitle(); });\n\n// Listen for changes to the textVariable\nWA.state.onVariableChange('textVariable').subscribe(() => {\n    console.log(`Text variable changed`);\n    updateTitle();\n});\n\n// Listen for changes to the colorVariable\nWA.state.onVariableChange('colorVariable').subscribe(() => {\n    console.log(`Color variable changed`);\n    updateTitle();\n});\nWA.onInit().then(() => {\nWA.room.area.onEnter('hideRoofZone').subscribe(() => {\n    WA.room.hideLayer('above-roof/above-roof1')\n    WA.room.hideLayer('above-roof/above-roof2')\n    WA.room.hideLayer('above-roof/above-roof3');\n})\nWA.room.area.onLeave('hideRoofZone').subscribe(() => {\n    WA.room.showLayer('above-roof/above-roof1')\n    WA.room.showLayer('above-roof/above-roof2')\n    WA.room.showLayer('above-roof/above-roof3');\n})})\n\nWA.onInit().then(async () => {\n    WA.player.onPlayerMove(async ({ x, y, moving }) => {\n      const material = await checkPlayerMaterial({ x, y });\n      console.log(material);\n  \n      if (!material) {\n        return mySound?.stop();\n      }\n  \n      if (!moving && !material) {\n        return mySound?.stop();\n      } else {\n        mySound?.stop();\n        return playRandomSound(material);\n      }\n    });\n  });\n\nexport {};\n"],"names":["MaterialType","soundFiles","audioConfig","mySound","stepSoundAreas","playRandomSound","material","randomIndex","getStepSoundAreas","layers","getLayersMap","areas","layer","object","prop","_a","error","isInsideArea","playerPosition","area","checkPlayerMaterial","currentPopup","today","time","closePopup","bootstrapExtra","e","updateTitle","text","color","newTitle","website","x","y","moving"],"mappings":"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"}